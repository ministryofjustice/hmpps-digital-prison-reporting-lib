[ {
  "id" : "external-movements",
  "name" : "External Movements",
  "description" : "Reports about prisoner external movements",
  "metadata" : {
    "author" : "Adam",
    "version" : "1.2.3",
    "owner" : "Eve"
  },
  "dataSource" : [
    {
      "id": "datamart",
      "name": "datamart"
    }],
  "dataset" : [ {
    "id" : "external-movements",
    "name" : "All movements",
    "query" : "SELECT prisoners.number AS prisonNumber,CONCAT(CONCAT(prisoners.lastname, ', '), substring(prisoners.firstname, 1, 1)) AS name,movements.time AS date,movements.direction,movements.type,movements.origin,movements.origin_code,movements.destination,movements.destination_code,movements.reason\nFROM movements_movements as movements\nJOIN prisoner_prisoner as prisoners\nON movements.prisoner = prisoners.id",
    "schema" : {
      "field" : [ {
        "name" : "prisonNumber",
        "type" : "String"
      }, {
        "name" : "name",
        "type" : "String"
      }, {
        "name" : "date",
        "type" : "Date"
      }, {
        "name" : "origin",
        "type" : "String"
      }, {
        "name" : "origin_code",
        "type" : "String",
        "caseload" : true
      }, {
        "name" : "destination",
        "type" : "String"
      },{
        "name" : "destination_code",
        "type" : "String",
        "caseload" : true
      }, {
        "name" : "direction",
        "type" : "String"
      }, {
        "name" : "type",
        "type" : "String"
      }, {
        "name" : "reason",
        "type" : "String"
      } ]
    }
  } ],
  "policy": [
    {
      "id": "case",
      "type": "row-level",
      "rule": [
        {
          "effect": "permit",
          "condition": [
            {
              "match": {
                "caseload": "$caseload"
              }
            }
          ]
        }
      ]
    }
  ],
  "report" : [ {
    "id" : "last-month",
    "name" : "Last month",
    "description" : "All movements in the past month",
    "created" : "2023-09-20",
    "classification": "report classification",
    "version" : "1.2.3",
    "dataset" : "$ref:external-movements",
    "policy" : [ ],
    "render" : "HTML",
    "specification" : {
      "template" : "list",
      "field" : [ {
        "name" : "$ref:prisonNumber",
        "display" : "Prison Number",
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:name",
        "display" : "Name",
        "wordWrap" : "None",
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:date",
        "display" : "Date",
        "filter" : {
          "type" : "date-range",
          "defaultValue" : "today(-1,months) - today()"
        },
        "sortable" : true,
        "default-sort" : true
      }, {
        "name" : "$ref:origin",
        "display" : "From",
        "wordWrap" : "None",
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:destination",
        "display" : "To",
        "wordWrap" : "None",
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:direction",
        "display" : "Direction",
        "filter" : {
          "type" : "Radio",
          "staticOptions" : [ {
            "name" : "in",
            "display" : "In"
          }, {
            "name" : "out",
            "display" : "Out"
          } ]
        },
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:type",
        "display" : "Type",
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:reason",
        "display" : "Reason",
        "sortable" : true,
        "default-sort" : false
      } ]
    },
    "destination" : [ ],
    "visible": "report visibility",
    "formula": "formula placeholder"
  }, {
    "id" : "last-week",
    "name" : "Last week",
    "description" : "All movements in the past week",
    "created" : "2023-09-20",
    "classification": "report classification",
    "version" : "1.2.3",
    "dataset" : "$ref:external-movements",
    "policy" : [ ],
    "render" : "HTML",
    "specification" : {
      "template" : "list",
      "field" : [ {
        "name" : "$ref:prisonNumber",
        "display" : "Prison Number",
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:name",
        "display" : "Name",
        "wordWrap" : "None",
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:date",
        "display" : "Date",
        "filter" : {
          "type" : "date-range",
          "defaultValue" : "today(-1,weeks) - today()"
        },
        "sortable" : true,
        "default-sort" : true
      }, {
        "name" : "$ref:origin",
        "display" : "From",
        "wordWrap" : "None",
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:destination",
        "display" : "To",
        "wordWrap" : "None",
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:direction",
        "display" : "Direction",
        "filter" : {
          "type" : "Radio",
          "staticOptions" : [ {
            "name" : "in",
            "display" : "In"
          }, {
            "name" : "out",
            "display" : "Out"
          } ]
        },
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:type",
        "display" : "Type",
        "sortable" : true,
        "default-sort" : false
      }, {
        "name" : "$ref:reason",
        "display" : "Reason",
        "sortable" : true,
        "default-sort" : false
      } ]
    },
    "destination" : [ ]
  } ]
}
]